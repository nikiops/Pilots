# ‚úÖ –≠–¢–ê–ü 3: –ú–û–î–ï–õ–ò –ë–î –ò SCHEMAS - –ó–ê–í–ï–†–®–Å–ù!

---

## üì¶ –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ:

### 1Ô∏è‚É£ **ORM –ú–æ–¥–µ–ª–∏ SQLAlchemy** (`app/models/`)

#### User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `telegram_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID Telegram
- `first_name, last_name` - –∏–º—è
- `avatar_url` - –∞–≤–∞—Ç–∞—Ä
- `bio, skills` - –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω–∞–≤—ã–∫–∏
- `rating, total_reviews` - —Ä–µ–π—Ç–∏–Ω–≥
- `balance, total_earned, total_spent` - —Ñ–∏–Ω–∞–Ω—Å—ã
- `completed_orders, cancelled_orders` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `is_active, is_banned` - —Å—Ç–∞—Ç—É—Å—ã
- `created_at, updated_at, last_active` - –¥–∞—Ç—ã

#### Service (–£—Å–ª—É–≥–∞/–ö–≤–æ—Ä–∫)
- `title, description` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
- `category` - –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–î–∏–∑–∞–π–Ω, –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–¥.)
- `tags` - —Ç–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
- `price` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞
- `execution_days` - —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `revision_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–æ–∫
- `preview_url` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `status` - —Å—Ç–∞—Ç—É—Å (PENDING, ACTIVE, REJECTED, HIDDEN)
- `total_orders, average_rating` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### Order (–ó–∞–∫–∞–∑)
- `buyer_id, seller_id, service_id` - —É—á–∞—Å—Ç–Ω–∏–∫–∏
- `price, platform_fee_percent, seller_gets` - —Ñ–∏–Ω–∞–Ω—Å—ã
- `status` - —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- `is_paid, payment_date` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ
- `deadline` - –¥–µ–¥–ª–∞–π–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `buyer_comment, seller_result` - –æ–±—â–µ–Ω–∏–µ
- `revisions_used, revisions_allowed` - –ø—Ä–∞–≤–∫–∏
- `created_at, completed_at` - –¥–∞—Ç—ã

#### Message (–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ)
- `order_id, author_id` - –∑–∞–∫–∞–∑ –∏ –∞–≤—Ç–æ—Ä
- `text` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `attachments` - –≤–ª–æ–∂–µ–Ω–∏—è (JSON)
- `is_edited, is_deleted` - —Ñ–ª–∞–≥–∏
- `created_at, edited_at` - –¥–∞—Ç—ã

#### Review (–û—Ç–∑—ã–≤)
- `order_id` - —Å–≤—è–∑—å —Å –∑–∞–∫–∞–∑–æ–º
- `reviewer_id` - –∫—Ç–æ –æ—Å—Ç–∞–≤–∏–ª –æ—Ç–∑—ã–≤
- `reviewed_user_id` - –∫–æ–≥–æ –æ—Ü–µ–Ω–∏–ª–∏
- `rating` - –æ—Ü–µ–Ω–∫–∞ (1-5)
- `text` - —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

#### Transaction (–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
- `user_id, order_id` - —É—á–∞—Å—Ç–Ω–∏–∫–∏
- `type` - —Ç–∏–ø (ESCROW, RELEASE, TOP_UP, WITHDRAWAL, REFUND, etc)
- `amount` - —Å—É–º–º–∞
- `status` - —Å—Ç–∞—Ç—É—Å (PENDING, COMPLETED, FAILED, REFUNDED)
- `description, reference` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `created_at, completed_at` - –¥–∞—Ç—ã

---

### 2Ô∏è‚É£ **Pydantic Schemas** (`app/schemas/`)

–î–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

#### User Schemas
- `UserBase` - –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
- `UserCreate` - –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `UserUpdate` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
- `UserResponse` - –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API
- `UserPublicResponse` - –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å

#### Service Schemas
- `ServiceBase` - –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
- `ServiceCreate` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—Å–ª—É–≥–∏
- `ServiceUpdate` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `ServiceResponse` - –æ—Ç–≤–µ—Ç API
- `ServiceDetailResponse` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

#### Order Schemas
- `OrderCreate` - –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —É—Å–ª—É–≥–∏
- `OrderUpdate` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- `OrderResponse` - –æ—Ç–≤–µ—Ç API
- `OrderDetailResponse` - —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

#### Message Schemas
- `MessageCreate` - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- `MessageResponse` - –æ—Ç–≤–µ—Ç API
- `MessageDetailResponse` - —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞–≤—Ç–æ—Ä–µ

#### Review Schemas
- `ReviewCreate` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞
- `ReviewResponse` - –æ—Ç–≤–µ—Ç API
- `ReviewDetailResponse` - —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞–≤—Ç–æ—Ä–µ

---

### 3Ô∏è‚É£ **–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

#### `app/db/base.py` ‚ú® –ù–û–í–´–ô
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è BaseClass
- –ò–∑–±–µ–≥–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### `app/db/session.py` - –û–ë–ù–û–í–õ–ï–ù
- Engine –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- SessionLocal –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
- –§—É–Ω–∫—Ü–∏—è `get_db()` –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å FastAPI

#### `init_db.py` ‚ú® –ù–û–í–´–ô
- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
- –°–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å: `python init_db.py`

---

## üîß –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î:

```bash
cd backend
python init_db.py
```

–ò–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ FastAPI:

```bash
python -m uvicorn app.main:app --port 8000
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API:

```python
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.models import User
from app.schemas import UserResponse

@app.get("/users/{user_id}", response_model=UserResponse)
async def get_user(user_id: int, db: Session = Depends(get_db)):
    user = db.query(User).filter(User.id == user_id).first()
    return user
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ë–î: `docs/DATABASE.md`

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **–ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - –≤—Å–µ –ø–æ–ª—è –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è Pydantic** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º  
‚úÖ **Foreign Keys** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏  
‚úÖ **Enum —Å—Ç–∞—Ç—É—Å—ã** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (PENDING, ACTIVE, etc)  
‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** - created_at, updated_at –¥–ª—è –∞—É–¥–∏—Ç–∞  
‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–ª—è–º  
‚úÖ **–ë–µ–∑ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞  

---

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –≠—Ç–∞–ø—É 4!

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –°–æ–∑–¥–∞–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π

–ù–∞ –≠—Ç–∞–ø–µ 4 —Å–æ–∑–¥–∞–¥–∏–º:
- Routes –¥–ª—è User (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ—Ñ–∏–ª—å, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- Routes –¥–ª—è Service (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–∏—Å–∫, –ø–æ–ª—É—á–µ–Ω–∏–µ)
- Routes –¥–ª—è Order (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞)
- Routes –¥–ª—è Messages (—á–∞—Ç)
- Routes –¥–ª—è Reviews (—Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞)

–¢–∞–∫–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `initData`.

üöÄ –ì–æ—Ç–æ–≤ –∫ –≠—Ç–∞–ø—É 4?
