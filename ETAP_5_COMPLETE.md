# –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞! ‚úÖ

## üéâ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

**Telegram –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å API:**

### ‚úÖ –§–∞–π–ª—ã –±–æ—Ç–∞

1. **api_client.py** (500+ —Å—Ç—Ä–æ–∫)
   - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
   - 20+ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ httpx
   - –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **handlers.py** (400+ —Å—Ç—Ä–æ–∫)
   - 6 –∫–æ–º–∞–Ω–¥: /start, /help, /profile, /search, /orders, /services
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –∏ –∑–∞–∫–∞–∑–æ–≤

3. **keyboards.py** (150+ —Å—Ç—Ä–æ–∫)
   - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (reply –∫–Ω–æ–ø–∫–∏)
   - Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É—Å–ª—É–≥
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
   - –°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—ã—Ö –∑–≤—ë–∑–¥

4. **callbacks_v2.py** (250+ —Å—Ç—Ä–æ–∫)
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
   - –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π —É—Å–ª—É–≥
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–æ–≤
   - –ß–∞—Ç –∑–∞–∫–∞–∑–∞
   - –û—Ç–∑—ã–≤—ã

5. **main.py** (–æ–±–Ω–æ–≤–ª–µ–Ω)
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥
   - Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üöÄ –ó–∞–ø—É—Å–∫ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç)

### –¢–µ—Ä–º–∏–Ω–∞–ª 1: Backend

```bash
cd d:\TgWork\TgWork\backend
.\venv\Scripts\activate
python -m uvicorn app.main:app --reload --port 8000
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete
```

### –¢–µ—Ä–º–∏–Ω–∞–ª 2: Telegram –ë–æ—Ç

```bash
cd d:\TgWork\TgWork\telegram-bot
.\venv\Scripts\activate
python main.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ TgWork...
```

### –¢–µ—Ä–º–∏–Ω–∞–ª 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
curl -X POST http://localhost:8000/api/users/ ^
  -H "Content-Type: application/json" ^
  -d "{\"telegram_id\": 123456, \"first_name\": \"Test\"}"

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram

1. **–û—Ç–∫—Ä—ã—Ç—å Telegram Desktop –∏–ª–∏ Mobile**
2. **–ù–∞–π—Ç–∏ –±–æ—Ç–∞** –ø–æ –∏–º–µ–Ω–∏ (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ @BotFather)
3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã:**

```
/start          ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help           ‚Üí –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
/profile        ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
/search         ‚Üí –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ (–∑–∞—Ç–µ–º –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ)
/orders         ‚Üí –ú–æ–∏ –∑–∞–∫–∞–∑—ã
/services       ‚Üí –ú–æ–∏ —É—Å–ª—É–≥–∏
```

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫:**
   - –í—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É ‚Üí –ó–∞–∫–∞–∑–∞—Ç—å ‚Üí –û–ø–ª–∞—Ç–∏—Ç—å
   - –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
   - –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
Telegram App
     ‚Üì
  (—Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∏)
     ‚Üì
Aiogram Bot (polling)
     ‚Üì
handlers.py (–∫–æ–º–∞–Ω–¥—ã) ‚Üí callbacks_v2.py (–∫–Ω–æ–ø–∫–∏)
     ‚Üì
api_client.py (HTTP –∑–∞–ø—Ä–æ—Å—ã)
     ‚Üì
FastAPI Backend (32 endpoints)
     ‚Üì
SQLite Database (6 –º–æ–¥–µ–ª–µ–π)
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
User: /start
  ‚Üí handlers.py::cmd_start()
  ‚Üí api_client.register_user() 
  ‚Üí POST /api/users/
  ‚Üí Backend —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ‚Üí –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

---

## üîó API –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ –≤ –±–æ—Ç–µ

```python
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
# ‚Üí handlers.py::handle_search_query()
await api_client.search_services("–ª–æ–≥–æ—Ç–∏–ø", limit=10)
# ‚Üí GET /api/services/search/?query=–ª–æ–≥–æ—Ç–∏–ø

# 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —É—Å–ª—É–≥—É
# ‚Üí callbacks_v2.py::callback_service_detail()
await api_client.get_service(service_id=1)
# ‚Üí GET /api/services/1

# 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–∫–∞–∑–∞—Ç—å"
# ‚Üí callbacks_v2.py::callback_order_service()
order = await api_client.create_order(buyer_id=123, service_id=1)
# ‚Üí POST /api/orders/
# ‚Üê –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç OrderResponse —Å ID –∏ —Å—Ç–∞—Ç—É—Å–æ–º

# 4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"
# ‚Üí callbacks_v2.py::callback_pay_order()
order = await api_client.pay_order(order_id=1)
# ‚Üí POST /api/orders/1/pay
# ‚Üê –°–æ–∑–¥–∞–µ—Ç escrow —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
# ‚Üê –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ IN_PROGRESS
```

---

## üéØ –§—É–Ω–∫—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º

### Backend (–≠—Ç–∞–ø 4) ‚Üí –ë–æ—Ç (–≠—Ç–∞–ø 5)

| –§—É–Ω–∫—Ü–∏—è | Backend Endpoint | –ë–æ—Ç –ö–æ–º–∞–Ω–¥–∞/–ö–Ω–æ–ø–∫–∞ |
|---------|------------------|-------------------|
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | POST /api/users/ | /start |
| –ü—Ä–æ—Ñ–∏–ª—å | GET /api/users/{id} | /profile |
| –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ | GET /api/services/search/ | /search |
| –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ | POST /api/orders/ | –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å" |
| –û–ø–ª–∞—Ç–∏—Ç—å | POST /api/orders/{id}/pay | –ö–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å" |
| –ß–∞—Ç | POST /api/orders/{id}/messages/ | –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å" |
| –û—Ç–∑—ã–≤ | POST /api/orders/{id}/review/ | –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤" |

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –≤ –∫–æ–¥–µ

### api_client.py - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç

```python
async def search_services(self, query: str, skip: int = 0, limit: int = 50) -> list:
    """–ü–æ–∏—Å–∫ —É—Å–ª—É–≥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"""
    params = {"query": query, "skip": skip, "limit": limit}
    async with self._request("GET", "/api/services/search/", params=params) as response:
        response.raise_for_status()
        return response.json()
```

### handlers.py - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã

```python
@router.message(Command("search"))
async def cmd_search(message: types.Message):
    """–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ —É—Å–ª—É–≥"""
    await message.answer("üîç –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:")
    # –ó–∞—Ç–µ–º handle_search_query() –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–≤–æ–¥
```

### callbacks_v2.py - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏

```python
@router.callback_query(F.data.startswith("order_service_"))
async def callback_order_service(query: types.CallbackQuery):
    """–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"""
    service_id = int(query.data.split("_")[2])
    order = await api_client.create_order(query.from_user.id, service_id)
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
```

---

## üîß –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
echo $env:TELEGRAM_BOT_TOKEN

# 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
# –ö–æ–Ω—Å–æ–ª—å –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
curl http://localhost:8000/docs  # –î–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ï—Å–ª–∏ API –æ—à–∏–±–∫–∞

```bash
# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ backend:
# ERROR:     Exception in ASGI application
# –°–∫–æ–ø–∏—Ä—É–π –æ—à–∏–±–∫—É –≤ Google/StackOverflow
```

### –ï—Å–ª–∏ –ë–î –æ—à–∏–±–∫–∞

```bash
# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
cd backend
python -c "from app.db.session import engine; from app.db.base import Base; Base.metadata.create_all(bind=engine)"
```

---

## üìà –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

1. **WebApp** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - push –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - Redis –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - PostgreSQL –≤–º–µ—Å—Ç–æ SQLite
6. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** - Docker Swarm –∏–ª–∏ Kubernetes

### –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX:

1. **–°–æ—Å—Ç–æ—è–Ω–∏—è (FSM)** - –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
2. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** - Stripe/YooKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
3. **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** - –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å –∏ —É—Å–ª—É–≥–∏
4. **–ê—É–¥–∏–æ/–í–∏–¥–µ–æ** - –æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
5. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª—É–≥ –∏ –∑–∞–∫–∞–∑–æ–≤
6. **–î–∏—Å—Ö–∞—Ç—ã** - –æ–±–º–µ–Ω –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

## ‚ú® –ò—Ç–æ–≥–æ

**TgWork MVP –≥–æ—Ç–æ–≤!** üéâ

‚úÖ Backend: 32 API endpoints
‚úÖ Database: 6 –º–æ–¥–µ–ª–µ–π —Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏
‚úÖ Telegram Bot: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚úÖ –ü–ª–∞—Ç–µ–∂–∏: Escrow —Å–∏—Å—Ç–µ–º–∞
‚úÖ –†–µ–π—Ç–∏–Ω–≥–∏: –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–æ–∫
‚úÖ –ß–∞—Ç: –û–±—â–µ–Ω–∏–µ –≤ –∑–∞–∫–∞–∑–∞—Ö

**–¢–µ–ø–µ—Ä—å —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!**

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```bash
# Terminal 1: Backend
cd d:\TgWork\TgWork\backend
.\venv\Scripts\activate
python -m uvicorn app.main:app --reload --port 8000

# Terminal 2: Bot
cd d:\TgWork\TgWork\telegram-bot
.\venv\Scripts\activate
python main.py

# Terminal 3: Test API
curl http://localhost:8000/docs
```

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üéä**
